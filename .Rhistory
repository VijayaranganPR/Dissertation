library(DescTools)  # to winsorize outliers
library(modelsummary) #for summarizing data/descriptive stataistics
library(corx)         # for the correlation matrix
library(fixest)       # for the regression analysis
library(pandoc)
# loading the data
loan_data <- read_csv("final_data_702.csv")
view(loan_data)
# extracting the variables we needed
my_loan_data <- loan_data %>%
select(gvkey, facilityid, contract_year,
total_esg_score, allindrawn, numcov1,
total_assets, profitability, leverage, industry,
facilityamt, num_lenders,
environment_score, social_score, governance_score)
view(my_loan_data)
# ESG score values starting at 2009 and ending at 2019
# so we are filtering it from 2009 to 2019
loan_data_clean <-  my_loan_data %>%
filter(between(contract_year, 2009, 2019))
view(loan_data_clean)
#####################
# Check the sample
#####################
n_distinct(loan_data_clean$gvkey)
n_distinct(loan_data_clean$facilityid)
table(loan_data_clean$contract_year)
sort(unique(loan_data_clean$contract_year))
##############################################
# drop borrowers who belongs to the finance industry
# because they are regulated differently
# (note that financial industry code=6)
##############################################
#loading industry data
industry_data <- read_csv("Industry.csv") %>%
select(gvkey, sic2, category)
view(industry_data)
loan_data_clean_with_industry <- loan_data_clean %>%
inner_join(industry_data, by = "gvkey")
view(loan_data_clean_with_industry)
# which industry codes we have in the data
table(loan_data_clean_with_industry$industry)
# unique years
unique(loan_data_clean_with_industry$industry)
# what industries we have in the data
unique(loan_data_clean_with_industry$category)
# Filter out records where industry is 6 or sic2 is between 59 and 70
loan_data_clean_non <- loan_data_clean_with_industry %>%
filter(!(industry == 6 | (sic2 >= 59 & sic2 <= 70)))
table(loan_data_clean_non$industry)
unique(loan_data_clean_non$category)
unique(loan_data_clean_non$sic2)
n_distinct(loan_data_clean_non$gvkey)
n_distinct(loan_data_clean_non$facilityid)
table(loan_data_clean_non$contract_year)
unique(loan_data_clean_non$contract_year)
#############
# skewness and outliners
#############
# checking the type
table(loan_data_clean_non$total_esg_score)  # continuous
table(loan_data_clean_non$allindrawn)       # continuous
table(loan_data_clean_non$numcov1)          # categorical
# check using histogram graph
loan_data_clean_non %>%
ggplot(aes(profitability)) +
geom_histogram()
loan_data_clean_non %>%
ggplot(aes(leverage)) +
geom_histogram()
loan_data_clean_non %>%
ggplot(aes(allindrawn)) +
geom_histogram()
loan_data_clean_non %>%
ggplot(aes(total_assets)) +
geom_histogram()
loan_data_clean_non %>%
ggplot(aes(total_esg_score)) +
geom_histogram()
loan_data_clean_non %>%
ggplot(aes(environment_score)) +
geom_histogram()
loan_data_clean_non %>%
ggplot(aes(social_score)) +
geom_histogram()
loan_data_clean_non %>%
ggplot(aes(governance_score)) +
geom_histogram()
loan_data_clean_non %>%
ggplot(aes(facilityamt)) +
geom_histogram()
loan_data_clean_non %>%
ggplot(aes(num_lenders)) +
geom_histogram()
# winsorize
loan_data_non <- loan_data_clean_non %>%
mutate(across(c(profitability, leverage), ~{
lower_bound <- quantile(.x, 0.01, na.rm = TRUE)
upper_bound <- quantile(.x, 0.99, na.rm = TRUE)
pmin(pmax(.x, lower_bound), upper_bound)
}, .names = "{col}_w")) %>%
mutate(across(c(total_esg_score,
allindrawn, total_assets, facilityamt, num_lenders),
~log(1 + .x), .names = "log_{col}"))
# look at the variables after winsorizing and log transforming
loan_data_non %>%
ggplot(aes(profitability_w)) +
geom_histogram()
loan_data_non %>%
ggplot(aes(leverage_w)) +
geom_histogram()
loan_data_non %>%
ggplot(aes(log_allindrawn)) +
geom_histogram()
loan_data_non %>%
ggplot(aes(log_total_assets)) +
geom_histogram()
loan_data_non %>%
ggplot(aes(log_total_esg_score)) +
geom_histogram()
loan_data_non %>%
ggplot(aes(log_facilityamt)) +
geom_histogram()
loan_data_non %>%
ggplot(aes(log_num_lenders)) +
geom_histogram()
view(loan_data_non)
# rename some variables to make the name self explanatory
loan_data_non <- loan_data_non %>%
rename(size = total_assets) %>%
rename(spread = allindrawn) %>%
rename(log_size = log_total_assets) %>%
rename(log_spread = log_allindrawn)
##############
# describe the data
##############
# Table 1: Summary Statistics
data_analysis <- loan_data_non %>%
select(log_total_esg_score, total_esg_score, spread, log_spread,
numcov1,
size, log_size,
facilityamt, log_facilityamt,
num_lenders, log_num_lenders,
profitability_w, leverage_w,
industry)
datasummary(total_esg_score + log_total_esg_score + spread + log_spread +
numcov1 +
size + log_size +
facilityamt + log_facilityamt +
num_lenders + log_num_lenders +
profitability_w + leverage_w +
industry
~ N + Mean + Median + SD + Min + P25 + P75 + Max,
title = "Table 1: Summary Statistics",
data = data_analysis,
fmt = 4,   #decimal places
output = "Summary_Statistics.docx")
######################
# correlation matrix
######################
data_analysis2 <- loan_data_non %>%
select(log_total_esg_score, log_spread,
numcov1,
log_size,
log_facilityamt,
log_num_lenders,
profitability_w, leverage_w)
data_analysis2 <- as.data.frame(data_analysis2) #convert to data frame
corr_matrix <- corx(data_analysis2,
stars = c(0.1, 0.05, 0.01),
triangle = "lower",
caption = "Table 2 Correlation matrix")
to_clipboard(corr_matrix) #copy to clipboard and then to excel
#########################
# regression results - Hypothesis 1
#########################
# Borrowers with high ESG scores secure syndicated loans at lower spread.
est1 <- loan_data_non %>%
feols(log_spread ~ log_total_esg_score)
est2 <- loan_data_non %>%
feols(log_spread ~ log_total_esg_score +
profitability_w + leverage_w + log_size + industry)
modelsummary(list(est1, est2), stars = c("*" = .1, "**" = .05, "***" = .01),
statistic = "p.value")
modelsummary(list(est1, est2), stars = c("*" = .1, "**" = .05, "***" = .01),
statistic = "p.value", output = "Hypothesis1.docx")
#########################
# regression results - Hypothesis 2
#########################
# Borrowers with high ESG scores experience less stringent loan covenants
# compared to borrowers with low ESG scores.
est3 <- loan_data_non %>%
feols(numcov1 ~ log_total_esg_score)
est4 <- loan_data_non %>%
feols(numcov1 ~ log_total_esg_score +
log_facilityamt + log_num_lenders + profitability_w + leverage_w +
log_size + industry)
modelsummary(list(est3, est4), stars = c("*" = .1, "**" = .05, "***" = .01),
statistic = "p.value")
modelsummary(list(est3, est4), stars = c("*" = .1, "**" = .05, "***" = .01),
statistic = "p.value", output = "Hypothesis2.docx")
# Hypothesis 1
# analysis for log_spread and environmental_score
est5 <- loan_data_non %>%
feols(log_spread ~ environment_score)
est6 <- loan_data_non %>%
feols(log_spread ~ environment_score +
profitability_w + leverage_w + log_size + industry)
est7 <- loan_data_non %>%
feols(log_spread ~ social_score)
est8 <- loan_data_non %>%
feols(log_spread ~ social_score +
profitability_w + leverage_w + log_size + industry)
est9 <- loan_data_non %>%
feols(log_spread ~ governance_score)
est10 <- loan_data_non %>%
feols(log_spread ~ governance_score +
profitability_w + leverage_w + log_size + industry)
modelsummary(list(est5, est6, est7, est8, est9, est10),
stars = c("*" = .1, "**" = .05, "***" = .01),
statistic = "p.value")
modelsummary(list(est5, est6, est7, est8, est9, est10),
stars = c("*" = .1, "**" = .05, "***" = .01),
statistic = "p.value", output = "Additional_analysis1.docx")
# Hypothesis2
# analysis for log_spread and environmental_score
est11 <- loan_data_non %>%
feols(numcov1 ~ environment_score)
est12 <- loan_data_non %>%
feols(numcov1 ~ environment_score +
log_facilityamt + log_num_lenders + profitability_w + leverage_w +
log_size + industry)
est13 <- loan_data_non %>%
feols(numcov1 ~ social_score)
est14 <- loan_data_non %>%
feols(numcov1 ~ social_score +
log_facilityamt + log_num_lenders + profitability_w + leverage_w +
log_size + industry)
est15 <- loan_data_non %>%
feols(numcov1 ~ governance_score)
est16 <- loan_data_non %>%
feols(numcov1 ~ governance_score +
log_facilityamt + log_num_lenders + profitability_w + leverage_w +
log_size + industry)
modelsummary(list(est11, est12, est13, est14, est15, est16),
stars = c("*" = .1, "**" = .05, "***" = .01),
statistic = "p.value")
modelsummary(list(est11, est12, est13, est14, est15, est16),
stars = c("*" = .1, "**" = .05, "***" = .01),
statistic = "p.value", output = "Additional_analysis2.docx")
# importing Packages
library(tidyverse)  #for reading data, wrangling, visualization etc.
library(DescTools)  # to winsorize outliers
library(modelsummary) #for summarizing data/descriptive stataistics
library(corx)         # for the correlation matrix
library(fixest)       # for the regression analysis
library(pandoc)
# loading the data
loan_data <- read_csv("final_data_702.csv")
view(loan_data)
# extracting the variables we needed
my_loan_data <- loan_data %>%
select(gvkey, facilityid, contract_year,
total_esg_score, allindrawn, numcov1,
total_assets, profitability, leverage, industry,
facilityamt, num_lenders,
environment_score, social_score, governance_score)
view(my_loan_data)
# ESG score values starting at 2009 and ending at 2019
# so we are filtering it from 2009 to 2019
loan_data_clean <-  my_loan_data %>%
filter(between(contract_year, 2009, 2019))
view(loan_data_clean)
#####################
# Check the sample
#####################
n_distinct(loan_data_clean$gvkey)
n_distinct(loan_data_clean$facilityid)
table(loan_data_clean$contract_year)
sort(unique(loan_data_clean$contract_year))
##############################################
# drop borrowers who belongs to the finance industry
# because they are regulated differently
# (note that financial industry code=6)
##############################################
#loading industry data
industry_data <- read_csv("Industry.csv") %>%
select(gvkey, sic2, category)
view(industry_data)
loan_data_clean_with_industry <- loan_data_clean %>%
inner_join(industry_data, by = "gvkey")
view(loan_data_clean_with_industry)
# which industry codes we have in the data
table(loan_data_clean_with_industry$industry)
# unique years
unique(loan_data_clean_with_industry$industry)
# what industries we have in the data
unique(loan_data_clean_with_industry$category)
# Filter out records where industry is 6 or sic2 is between 59 and 70
loan_data_clean_non <- loan_data_clean_with_industry %>%
filter(!(industry == 6 | (sic2 >= 59 & sic2 <= 70)))
table(loan_data_clean_non$industry)
unique(loan_data_clean_non$category)
unique(loan_data_clean_non$sic2)
n_distinct(loan_data_clean_non$gvkey)
n_distinct(loan_data_clean_non$facilityid)
table(loan_data_clean_non$contract_year)
unique(loan_data_clean_non$contract_year)
#############
# skewness and outliners
#############
# checking the type
table(loan_data_clean_non$total_esg_score)  # continuous
table(loan_data_clean_non$allindrawn)       # continuous
table(loan_data_clean_non$numcov1)          # categorical
# check using histogram graph
loan_data_clean_non %>%
ggplot(aes(profitability)) +
geom_histogram()
loan_data_clean_non %>%
ggplot(aes(leverage)) +
geom_histogram()
loan_data_clean_non %>%
ggplot(aes(allindrawn)) +
geom_histogram()
loan_data_clean_non %>%
ggplot(aes(total_assets)) +
geom_histogram()
loan_data_clean_non %>%
ggplot(aes(total_esg_score)) +
geom_histogram()
loan_data_clean_non %>%
ggplot(aes(environment_score)) +
geom_histogram()
loan_data_clean_non %>%
ggplot(aes(social_score)) +
geom_histogram()
loan_data_clean_non %>%
ggplot(aes(governance_score)) +
geom_histogram()
loan_data_clean_non %>%
ggplot(aes(facilityamt)) +
geom_histogram()
loan_data_clean_non %>%
ggplot(aes(num_lenders)) +
geom_histogram()
# winsorize
loan_data_non <- loan_data_clean_non %>%
mutate(across(c(profitability, leverage), ~{
lower_bound <- quantile(.x, 0.01, na.rm = TRUE)
upper_bound <- quantile(.x, 0.99, na.rm = TRUE)
pmin(pmax(.x, lower_bound), upper_bound)
}, .names = "{col}_w")) %>%
mutate(across(c(total_esg_score,
environment_score, social_score, governance_score,
allindrawn, total_assets, facilityamt, num_lenders),
~log(1 + .x), .names = "log_{col}"))
# look at the variables after winsorizing and log transforming
loan_data_non %>%
ggplot(aes(profitability_w)) +
geom_histogram()
loan_data_non %>%
ggplot(aes(leverage_w)) +
geom_histogram()
loan_data_non %>%
ggplot(aes(log_allindrawn)) +
geom_histogram()
loan_data_non %>%
ggplot(aes(log_total_assets)) +
geom_histogram()
loan_data_non %>%
ggplot(aes(log_total_esg_score)) +
geom_histogram()
loan_data_non %>%
ggplot(aes(log_environment_score)) +
geom_histogram()
loan_data_non %>%
ggplot(aes(log_social_score)) +
geom_histogram()
loan_data_non %>%
ggplot(aes(log_governance_score)) +
geom_histogram()
loan_data_non %>%
ggplot(aes(log_facilityamt)) +
geom_histogram()
loan_data_non %>%
ggplot(aes(log_num_lenders)) +
geom_histogram()
view(loan_data_non)
# rename some variables to make the name self explanatory
loan_data_non <- loan_data_non %>%
rename(size = total_assets) %>%
rename(spread = allindrawn) %>%
rename(log_size = log_total_assets) %>%
rename(log_spread = log_allindrawn)
##############
# describe the data
##############
# Table 1: Summary Statistics
data_analysis <- loan_data_non %>%
select(log_total_esg_score, total_esg_score, spread, log_spread,
numcov1,
size, log_size,
facilityamt, log_facilityamt,
num_lenders, log_num_lenders,
profitability_w, leverage_w,
industry)
datasummary(total_esg_score + log_total_esg_score + spread + log_spread +
numcov1 +
size + log_size +
facilityamt + log_facilityamt +
num_lenders + log_num_lenders +
profitability_w + leverage_w +
industry
~ N + Mean + Median + SD + Min + P25 + P75 + Max,
title = "Table 1: Summary Statistics",
data = data_analysis,
fmt = 4,   #decimal places
output = "Summary_Statistics.docx")
######################
# correlation matrix
######################
data_analysis2 <- loan_data_non %>%
select(log_total_esg_score, log_spread,
numcov1,
log_size,
log_facilityamt,
log_num_lenders,
profitability_w, leverage_w)
data_analysis2 <- as.data.frame(data_analysis2) #convert to data frame
corr_matrix <- corx(data_analysis2,
stars = c(0.1, 0.05, 0.01),
triangle = "lower",
caption = "Table 2 Correlation matrix")
to_clipboard(corr_matrix) #copy to clipboard and then to excel
#########################
# regression results - Hypothesis 1
#########################
# Borrowers with high ESG scores secure syndicated loans at lower spread.
est1 <- loan_data_non %>%
feols(log_spread ~ log_total_esg_score)
est2 <- loan_data_non %>%
feols(log_spread ~ log_total_esg_score +
profitability_w + leverage_w + log_size + industry)
modelsummary(list(est1, est2), stars = c("*" = .1, "**" = .05, "***" = .01),
statistic = "p.value")
modelsummary(list(est1, est2), stars = c("*" = .1, "**" = .05, "***" = .01),
statistic = "p.value", output = "Hypothesis1.docx")
#########################
# regression results - Hypothesis 2
#########################
# Borrowers with high ESG scores experience less stringent loan covenants
# compared to borrowers with low ESG scores.
est3 <- loan_data_non %>%
feols(numcov1 ~ log_total_esg_score)
est4 <- loan_data_non %>%
feols(numcov1 ~ log_total_esg_score +
log_facilityamt + log_num_lenders + profitability_w + leverage_w +
log_size + industry)
modelsummary(list(est3, est4), stars = c("*" = .1, "**" = .05, "***" = .01),
statistic = "p.value")
modelsummary(list(est3, est4), stars = c("*" = .1, "**" = .05, "***" = .01),
statistic = "p.value", output = "Hypothesis2.docx")
# Hypothesis 1
# analysis for log_spread and environmental_score
est5 <- loan_data_non %>%
feols(log_spread ~ log_environment_score)
est6 <- loan_data_non %>%
feols(log_spread ~ log_environment_score +
profitability_w + leverage_w + log_size + industry)
est7 <- loan_data_non %>%
feols(log_spread ~ log_social_score)
est8 <- loan_data_non %>%
feols(log_spread ~ log_social_score +
profitability_w + leverage_w + log_size + industry)
est9 <- loan_data_non %>%
feols(log_spread ~ log_governance_score)
est10 <- loan_data_non %>%
feols(log_spread ~ log_governance_score +
profitability_w + leverage_w + log_size + industry)
modelsummary(list(est5, est6, est7, est8, est9, est10),
stars = c("*" = .1, "**" = .05, "***" = .01),
statistic = "p.value")
modelsummary(list(est5, est6, est7, est8, est9, est10),
stars = c("*" = .1, "**" = .05, "***" = .01),
statistic = "p.value", output = "Additional_analysis1.docx")
# Hypothesis2
# analysis for log_spread and environmental_score
est11 <- loan_data_non %>%
feols(numcov1 ~ log_environment_score)
est12 <- loan_data_non %>%
feols(numcov1 ~ log_environment_score +
log_facilityamt + log_num_lenders + profitability_w + leverage_w +
log_size + industry)
est13 <- loan_data_non %>%
feols(numcov1 ~ log_social_score)
est14 <- loan_data_non %>%
feols(numcov1 ~ log_social_score +
log_facilityamt + log_num_lenders + profitability_w + leverage_w +
log_size + industry)
est15 <- loan_data_non %>%
feols(numcov1 ~ log_governance_score)
est16 <- loan_data_non %>%
feols(numcov1 ~ log_governance_score +
log_facilityamt + log_num_lenders + profitability_w + leverage_w +
log_size + industry)
modelsummary(list(est11, est12, est13, est14, est15, est16),
stars = c("*" = .1, "**" = .05, "***" = .01),
statistic = "p.value")
modelsummary(list(est11, est12, est13, est14, est15, est16),
stars = c("*" = .1, "**" = .05, "***" = .01),
statistic = "p.value", output = "Additional_analysis2.docx")
